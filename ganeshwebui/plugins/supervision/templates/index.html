{% extends ../../../templates/base.html %}

{% block title %}[{{instance.hostname}}:{{instance.pg_port}}] - Supervision{% end %}

{% block content %}
<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    			<h4 class="modal-title" id="ModalLabel"></h4>
    		</div>
    		<div class="modal-body" id="ModalBody">
				<img id="imageModal" width="100%"/>
      		</div>
      		<div class="modal-footer" id="ModalFooter">
        		<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      		</div>
    	</div>
  	</div>
</div>
<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<h1><i class="fa fa-bar-chart-o"></i> Supervision <small>/</small> Charts <small>/</small> Last {{period}}</h1>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Loadavg"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="CPU"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="CtxForks"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Memory"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Swap"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="FsSize"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="FsUsage"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="TPS"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="InstanceSize"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="TblspcSize"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Sessions"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Blocks"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="HRR"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Checkpoints"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="WBuffers"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="Locks"></div>
	</div>
	<div class="row">
		<div class="col-md-12" id="WLocks"></div>
	</div>
</div>

<script src="/js/dygraph-combined.js"></script>
<script src="/js/dygraph-extra.js"></script>
<script src="/js/supervision/ganesh.supervision.js"></script>
<script>
sync_graphs = [];
api_url = "/server/{{instance.agent_address}}/{{instance.agent_port}}/supervision/data";
start_date = "{{escape(start_date)}}";
end_date = "{{escape(end_date)}}";
orig_xAxisRange = null;

$(document).ready(function() {
	var graphs = [
		// System
		{id: "Loadavg",title: "Loadaverage",api: "loadavg",options: {colors: ['#2d7fbf', '#bf562d', '#2dbf4c'], ylabel: "Loadaverage"}},
		{id: "CPU",title: "CPU Usage",api: "cpu",options: {colors: ['#2d7fbf', '#2dbf4c', '#bf562d', '#666666'], ylabel: "%", stackedGraph: true}},
		{id: "CtxForks",title: "Context switches and forks per second",api: "ctxforks",options: {colors: ['#2d7fbf', '#223cbf']}},
		{id: "Memory",title: "Memory usage",api: "memory",options: {colors: ['#aaaaaa', '#2dbf4c', '#2d7fbf', '#223cbf'], ylabel: "Memory", labelsKMG2: true, stackedGraph: true}},
		{id: "Swap",title: "Swap usage",api: "swap",options: {colors: ['#bf562d'], ylabel: "Swap", labelsKMG2: true, stackedGraph: true}},
		{id: "FsSize",title: "Filesystems size",api: "fs_size",options: {ylabel: "Size", labelsKMG2: true}},
		{id: "FsUsage",title: "Filesystems usage",api: "fs_usage",options: {ylabel: "%"}},
		// PostgreSQL
		{id: "TPS",title: "Transactions per second",api: "tps",options: {colors: ['#2dbf4c', '#bf562d'], ylabel: "Transactions", stackedGraph: true}},
		{id: "InstanceSize",title: "Instance size",api: "instance_size",options: {colors: ['#2d7fbf'], ylabel: "Size", stackedGraph: true, labelsKMG2: true}},
		{id: "TblspcSize",title: "Tablespaces size",api: "tblspc_size",options: {ylabel: "Size", stackedGraph: true, labelsKMG2: true}},
		{id: "Sessions",title: "Sessions",api: "sessions",options: {ylabel: "Sessions", stackedGraph: true}},
		{id: "Blocks",title: "Blocks Hit vs Read per second",api: "blocks",options: {colors: ['#bf562d', '#2dbf4c'], ylabel: "Blocks"}},
		{id: "HRR",title: "Blocks Hit vs Read ratio",api: "hitreadratio",options: {colors: ['#2d7fbf'], ylabel: "%"}},
		{id: "Checkpoints",title: "Checkpoints",api: "checkpoints",options: {labels: [ 'Date', 'timed', 'requested', 'write_time', 'sync_time' ], ylabel: "Checkpoints", y2label: "Duration", series: {'write_time': {axis: 'y2'},'sync_time': {axis: 'y2'}}}},
		{id: "WBuffers",title: "Written buffers",api: "w_buffers",options: {ylabel: "Written buffers", stackedGraph: true}},
		{id: "Locks",title: "Locks",api: "locks",options: {ylabel: "Locks"}},
		{id: "WLocks",title: "Waiting Locks",api: "waiting_locks",options: {ylabel: "Waiting Locks"}}
	];

	for (var graph of graphs)
	{
		sync_graphs.push({
			dygraph: new_graph(graph.id, graph.title, graph.api, api_url, graph.options, start_date, end_date),
			api: graph.api
		});
	}
});

</script>

{% end %}
